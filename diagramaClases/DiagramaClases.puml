@startuml

skinparam classAttributeIconSize 0
skinparam monochrome true
skinparam shadowing false
skinparam linetype ortho

title Diagrama de Clases - VetCare

package "Capa de Vistas" {
    class login_jsp <<JSP>>
    class index_jsp <<JSP>>
    class gestionVeterinarios_jsp <<JSP>>
    class home_admin_jsp <<JSP>>
    class home_cliente_jsp <<JSP>>
    class home_veterinario_jsp <<JSP>>
    class misCitas_jsp <<JSP>>
    class misMascotas_jsp <<JSP>>
    class registrarConsulta_jsp <<JSP>>
    class registrarMascota_jsp <<JSP>>
    class registrarVeterinario_jsp <<JSP>>
    class agendarCita_jsp <<JSP>>
}

package "Capa de Control" {
    class AutenticarController {
        + doPost(req: HttpServletRequest, resp: HttpServletResponse)
        + doGet(req: HttpServletRequest, resp: HttpServletResponse)
        - login(req: HttpServletRequest, resp: HttpServletResponse)
        - logout(req: HttpServletRequest, resp: HttpServletResponse)
    }

    class ControlMascota {
        + doPost(req: HttpServletRequest, resp: HttpServletResponse)
        + doGet(req: HttpServletRequest, resp: HttpServletResponse)
        - eliminar(req: HttpServletRequest, resp: HttpServletResponse)
    }

    class ControlAgendamiento {
        + doPost(req: HttpServletRequest, resp: HttpServletResponse)
        + doGet(req: HttpServletRequest, resp: HttpServletResponse)
    }

    class ControlConsulta {
        + doPost(req: HttpServletRequest, resp: HttpServletResponse)
        + doGet(req: HttpServletRequest, resp: HttpServletResponse)
    }

    class ControlUsuario {
        + doPost(req: HttpServletRequest, resp: HttpServletResponse)
        + doGet(req: HttpServletRequest, resp: HttpServletResponse)
    }
}

package "Capa de Dominio/Entidades" {
    class Usuario {
        - id: int
        - nombre: String
        - usuario: String
        - clave: String
        - rol: String
        - estado: String
        + getRol(): String
        + setEstado(estado: String)
    }

    class Cliente {
        - mascotas: List<Mascota>
        + agregarMascota(m: Mascota)
    }

    class Veterinario {
        - identificacion: String
        - telefono: String
        - especialidad: String
        + validarCupo(fecha: Date): boolean
    }

    class Mascota {
        - id: int
        - nombre: String
        - especie: String
        - raza: String
        - fechaNac: Date
        - peso: double
        - foto: Byte[]
        - cliente: Cliente
        + getId(): int
    }

    class Cita {
        - idCita: int
        - fecha: Date
        - hora: Time
        - motivo: String
        - estado: String
        - consulta: Consulta
        - mascota: Mascota
        - veterinario: Veterinario
        + setIdCita(id: int)
        + setEstado(estado: String)
    }

    class Consulta {
        - id: int
        - sintomas: String
        - diagnostico: String
        - tratamiento: String
        - observaciones: String
        - cita: Cita
        - recetas: List<Receta>
    }

    class Receta {
        - id: int
        - medicamento: String
        - dosis: String
        - frecuencia: String
        - duracion: String
        - consulta: Consulta
    }

    Usuario <|-- Cliente
    Usuario <|-- Veterinario
    Cliente "1" -- "0..*" Mascota
    Mascota "1" -- "0..*" Cita
    Veterinario "1" -- "0..*" Cita
    Cita "1" -- "0..1" Consulta
    Consulta "1" -- "0..*" Receta
}

package "Capa de Acceso a Datos (DAO)" {
    class UsuarioDAO {
        + validarCredenciales(usuario: String, clave: String): Usuario
        + guardar(usuario: Usuario): boolean
        + actualizar(usuario: Usuario): boolean
        + buscarPorId(id: int): Usuario
        + listarVeterinarios(): List<Veterinario>
        + listarVeterinariosActivos(): List<Veterinario>
        + desactivar(idUsuario: int): boolean
        + listarTodos(): List<Usuario>
    }

    class MascotaDAO {
        + guardar(m: Mascota): boolean
        + buscarPorCliente(idCliente: int): List<Mascota>
        + buscarPorId(id: int): Mascota
        + eliminar(id: int): boolean
    }

    class CitaDAO {
        + guardar(c: Cita): boolean
        + listarPorVeterinario(idVeterinario: int): List<Cita>
        + listarPorCliente(idCliente: int): List<Cita>
        + buscarPorId(id: int): Cita
    }

    class ConsultaDAO {
        + guardar(consulta: Consulta): boolean
    }
}

' --- RELACIONES ---

' Controladores -> Views (Navigation)
AutenticarController ..> login_jsp : redirige
AutenticarController ..> index_jsp : redirige
ControlUsuario ..> gestionVeterinarios_jsp : forward
ControlUsuario ..> registrarVeterinario_jsp : forward
ControlUsuario ..> home_admin_jsp : redirige
ControlMascota ..> misMascotas_jsp : forward
ControlAgendamiento ..> agendarCita_jsp : forward
ControlAgendamiento ..> misCitas_jsp : forward
ControlConsulta ..> registrarConsulta_jsp : forward
ControlConsulta ..> home_veterinario_jsp : redirige

' Controladores -> DAOs
AutenticarController --> UsuarioDAO : usa
ControlUsuario --> UsuarioDAO : usa
ControlMascota --> MascotaDAO : usa
ControlAgendamiento --> CitaDAO : usa
ControlAgendamiento --> MascotaDAO : usa (para listar)
ControlAgendamiento --> UsuarioDAO : usa (para listar vet)
ControlConsulta --> ConsultaDAO : usa

' DAOs -> Entidades
UsuarioDAO ..> Usuario : gestiona
UsuarioDAO ..> Veterinario : gestiona
MascotaDAO ..> Mascota : gestiona
CitaDAO ..> Cita : gestiona
ConsultaDAO ..> Consulta : gestiona

@enduml
